<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö—Ä—É–≥–æ–≤–æ–π –¢–∞–π–º–µ—Ä-–ë—É–¥–∏–ª—å–Ω–∏–∫ 24h</title>
    <style>
        /* === –û–ë–©–ò–ï –°–¢–ò–õ–ò === */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #1a1a1a;
            color: #fff;
            margin: 0;
            flex-direction: column;
        }
        .container {
            background: #2c2c2c;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 450px;
            width: 90%;
            text-align: center;
        }
        h1 {
            color: #76c7c0;
            margin-bottom: 25px;
        }

        /* === –°–¢–ò–õ–ò –ö–û–õ–ï–°–ê –í–´–ë–û–†–ê –í–†–ï–ú–ï–ù–ò === */
        .time-picker {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
        }
        .time-picker-column {
            /* –í—ã—Å–æ—Ç–∞, –∏–º–∏—Ç–∏—Ä—É—é—â–∞—è "–æ–∫–Ω–æ" –≤—ã–±–æ—Ä–∞ */
            height: 180px;
            width: 80px;
            overflow-y: scroll;
            border-radius: 8px;
            position: relative;
            /* –í–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏–≤—è–∑–∫–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ "–∑–∞—â–µ–ª–∫–∏–≤–∞–Ω–∏—è" */
            scroll-snap-type: y mandatory;
            background-color: #3a3a3a;
            scrollbar-width: none; /* –°–∫—Ä—ã—Ç–∏–µ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ –¥–ª—è Firefox */
            -ms-overflow-style: none; /* –°–∫—Ä—ã—Ç–∏–µ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ –¥–ª—è IE/Edge */
        }
        /* –°–∫—Ä—ã—Ç–∏–µ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ –¥–ª—è Chrome, Safari, Opera */
        .time-picker-column::-webkit-scrollbar {
            display: none;
        }

        .time-picker-item {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 60px; /* –í—ã—Å–æ—Ç–∞ –æ–¥–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ (–æ–∫–Ω–æ = 3 —ç–ª–µ–º–µ–Ω—Ç–∞) */
            font-size: 32px;
            font-weight: 500;
            color: #888;
            /* –ü—Ä–∏–≤—è–∑–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∫ —Ü–µ–Ω—Ç—Ä—É —ç–ª–µ–º–µ–Ω—Ç–∞ */
            scroll-snap-align: center;
            transition: color 0.2s, transform 0.2s;
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Å—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–±–æ—Ä–∞ */
        .time-picker-column::before,
        .time-picker-column::after {
            content: "";
            display: block;
            height: 60px; /* –ü–æ–ª–æ–≤–∏–Ω–∞ –≤—ã—Å–æ—Ç—ã –æ–∫–Ω–∞ –º–∏–Ω—É—Å –≤—ã—Å–æ—Ç–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ */
        }

        /* –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å ":" */
        .separator {
            font-size: 32px;
            color: #76c7c0;
            margin: 0 5px;
            line-height: 60px;
            height: 60px;
        }

        /* === –°–¢–ò–õ–ò –ö–ù–û–ü–û–ö –ò –°–û–û–ë–©–ï–ù–ò–ô === */
        button {
            padding: 12px 25px;
            font-size: 18px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            transition: background-color 0.3s;
            margin: 5px;
            font-weight: bold;
        }
        #setButton {
            background-color: #76c7c0;
            color: #1a1a1a;
        }
        #setButton:hover {
            background-color: #5fb1ab;
        }
        #stopButton {
            background-color: #dc3545;
            color: white;
            display: none;
        }
        #stopButton:hover {
            background-color: #c82333;
        }
        #message {
            margin-top: 25px;
            font-size: 18px;
            min-height: 25px;
            color: #a0ff80;
        }
        .alarm-sound {
            display: none;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>‚è∞ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ë—É–¥–∏–ª—å–Ω–∏–∫ (24—á)</h1>

        <div class="time-picker">
            <div id="hoursColumn" class="time-picker-column">
                </div>
            <div class="separator">:</div>
            <div id="minutesColumn" class="time-picker-column">
                </div>
        </div>

        <button id="setButton" onclick="setAlarm()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¢–∞–π–º–µ—Ä</button>
        <button id="stopButton" onclick="stopAlarm()">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>

        <div id="message"></div>

        <audio id="alarmSound" class="alarm-sound" loop>
            <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
        </audio>
    </div>

    <script>
        const HOURS_COLUMN = document.getElementById('hoursColumn');
        const MINUTES_COLUMN = document.getElementById('minutesColumn');
        const ALARM_SOUND = document.getElementById('alarmSound');
        const MESSAGE_DISPLAY = document.getElementById('message');
        const SET_BUTTON = document.getElementById('setButton');
        const STOP_BUTTON = document.getElementById('stopButton');
        const ITEM_HEIGHT = 60; // –î–æ–ª–∂–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å .time-picker-item height –≤ CSS

        let alarmInterval;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–∏—Å–ª–∞ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–µ–¥—É—â–µ–≥–æ –Ω—É–ª—è)
        const formatTime = (value) => value.toString().padStart(2, '0');

        // === 1. –ó–ê–ü–û–õ–ù–ï–ù–ò–ï –ö–û–õ–û–ù–û–ö (–ö–û–õ–ï–°) ===
        function populateColumns() {
            // –ß–∞—Å—ã (00 –¥–æ 23)
            for (let i = 0; i < 24; i++) {
                const div = document.createElement('div');
                div.className = 'time-picker-item';
                div.textContent = formatTime(i);
                HOURS_COLUMN.appendChild(div);
            }

            // –ú–∏–Ω—É—Ç—ã (00 –¥–æ 59)
            for (let i = 0; i < 60; i++) {
                const div = document.createElement('div');
                div.className = 'time-picker-item';
                div.textContent = formatTime(i);
                MINUTES_COLUMN.appendChild(div);
            }

            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π)
            const now = new Date();
            scrollToItem(HOURS_COLUMN, now.getHours());
            scrollToItem(MINUTES_COLUMN, now.getMinutes());

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ª—É—à–∞—Ç–µ–ª–µ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –¥–ª—è "–∑–∞—Ö–≤–∞—Ç–∞" –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
            HOURS_COLUMN.addEventListener('scroll', handleScrollEnd);
            MINUTES_COLUMN.addEventListener('scroll', handleScrollEnd);
        }

        // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —ç–ª–µ–º–µ–Ω—Ç—É –ø–æ –∏–Ω–¥–µ–∫—Å—É
        function scrollToItem(column, index) {
            column.scrollTop = index * ITEM_HEIGHT;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–¥–µ—Ä–∂–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏, —á—Ç–æ–±—ã –¥–æ–∂–¥–∞—Ç—å—Å—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
        let scrollTimeout;
        function handleScrollEnd(event) {
            const column = event.target;
            clearTimeout(scrollTimeout);

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–∞—É—Ç, —á—Ç–æ–±—ã –ø–æ–¥–æ–∂–¥–∞—Ç—å, –ø–æ–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è (–∏–∑-–∑–∞ scroll-snap)
            scrollTimeout = setTimeout(() => {
                // –í—ã—á–∏—Å–ª—è–µ–º –∏–Ω–¥–µ–∫—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ "–æ–∫–Ω–∞"
                const selectedIndex = Math.round(column.scrollTop / ITEM_HEIGHT);

                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –±–ª–∏–∂–∞–π—à–µ–º—É "–∑–∞—â–µ–ª–∫–Ω—É—Ç–æ–º—É" —ç–ª–µ–º–µ–Ω—Ç—É, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è –≤ –µ–≥–æ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–∏
                column.scrollTop = selectedIndex * ITEM_HEIGHT;

                // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫—É –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                // const items = column.querySelectorAll('.time-picker-item');
                // items.forEach((item, index) => {
                //     item.style.color = index === selectedIndex ? '#fff' : '#888';
                // });
            }, 100); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
        }

        // === 2. –õ–û–ì–ò–ö–ê –¢–ê–ô–ú–ï–†–ê ===

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —á–∞—Å–∞/–º–∏–Ω—É—Ç—ã –∏–∑ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –∫–æ–ª–µ—Å–∞
        function getSelectedTime(column) {
            const selectedIndex = Math.round(column.scrollTop / ITEM_HEIGHT);
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (0-23 –∏–ª–∏ 0-59)
            return selectedIndex;
        }

        function setAlarm() {
            // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            const selectedHour = getSelectedTime(HOURS_COLUMN);
            const selectedMinute = getSelectedTime(MINUTES_COLUMN);
            const alarmTimeString = `${formatTime(selectedHour)}:${formatTime(selectedMinute)}`;

            // –°–æ–∑–¥–∞–µ–º —Ü–µ–ª–µ–≤—É—é –¥–∞—Ç—É
            const now = new Date();
            let alarmTarget = new Date(now.getFullYear(), now.getMonth(), now.getDate(), selectedHour, selectedMinute, 0);

            // –ï—Å–ª–∏ –≤—Ä–µ–º—è —É–∂–µ –ø—Ä–æ—à–ª–æ —Å–µ–≥–æ–¥–Ω—è, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞ –∑–∞–≤—Ç—Ä–∞
            if (alarmTarget.getTime() <= now.getTime()) {
                alarmTarget.setDate(alarmTarget.getDate() + 1);
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ –∑–∞–ø—É—Å–∫ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
            stopAlarm(false); // –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä –±–µ–∑ —Å–±—Ä–æ—Å–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            HOURS_COLUMN.style.pointerEvents = 'none'; // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—ã–±–æ—Ä–∞
            MINUTES_COLUMN.style.pointerEvents = 'none';
            SET_BUTTON.disabled = true;
            STOP_BUTTON.style.display = 'inline-block';

            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
            alarmInterval = setInterval(() => {
                const currentTime = new Date().getTime();

                if (currentTime >= alarmTarget.getTime()) {
                    triggerAlarm(alarmTimeString);
                } else {
                    const remaining = alarmTarget.getTime() - currentTime;
                    const h = Math.floor(remaining / (1000 * 60 * 60));
                    const m = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                    const s = Math.floor((remaining % (1000 * 60)) / 1000);

                    MESSAGE_DISPLAY.textContent = `–î–æ –∑–≤–æ–Ω–∫–∞ –≤ ${alarmTimeString} –æ—Å—Ç–∞–ª–æ—Å—å: ${h}—á ${m}–º–∏–Ω ${s}—Å–µ–∫`;
                }
            }, 1000);
            sendToServer(alarmTimeString);
        }

        function triggerAlarm(time) {
            clearInterval(alarmInterval);
            ALARM_SOUND.play();
            MESSAGE_DISPLAY.textContent = `üö® –ë–£–î–ò–õ–¨–ù–ò–ö! –í—Ä–µ–º—è ${time}!`;

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä, —á—Ç–æ–±—ã Python-–±–æ—Ç —Å—Ä–∞–±–æ—Ç–∞–ª
            fetch("http://127.0.0.1:5000/send_message", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({text: `‚è∞ –ë—É–¥–∏–ª—å–Ω–∏–∫! –í—Ä–µ–º—è ${time}`})
            })
            .then(res => res.json())
            .then(data => console.log("–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", data))
            .catch(err => console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:", err));
        }

        function sendToServer(timeString) {
            fetch("http://localhost:5000/set_alarm", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ time: timeString })
            })
            .then(res => res.json())
            .then(data => console.log(data))
            .catch(err => console.error("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º:", err));
        }

        function stopAlarm(reset = true) {
            if (alarmInterval) {
                clearInterval(alarmInterval);
            }
            ALARM_SOUND.pause();
            ALARM_SOUND.currentTime = 0;

            if (reset) {
                MESSAGE_DISPLAY.textContent = '–¢–∞–π–º–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–≤–æ–µ –≤—Ä–µ–º—è.';
                HOURS_COLUMN.style.pointerEvents = 'auto'; // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—ã–±–æ—Ä–∞
                MINUTES_COLUMN.style.pointerEvents = 'auto';
                SET_BUTTON.disabled = false;
                STOP_BUTTON.style.display = 'none';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = populateColumns;
    </script>

</body>
</html>
